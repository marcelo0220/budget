<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Budget Pro AI+ ‚úÖ BUDGET MODIFIABLE</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--primary:#3f51b5;--accent:#ffd700;--glass:rgba(255,255,255,0.1);--success:#4ecdc4;--warning:#ff6b6b;--bg-dark:linear-gradient(135deg,#0a0e17,#1a237e);--radius:16px}
body{font-family:'Inter',sans-serif;background:var(--bg-dark);color:#fff;min-height:100vh}
.light{--glass:rgba(0,0,0,0.05);background:#f8fafc;color:#1e293b}
.container{max-width:1200px;margin:auto;padding:20px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
h1{font-size:28px;font-weight:700;background:linear-gradient(135deg,#fff,#ffd700);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.theme-toggle{width:50px;height:50px;border-radius:50%;background:var(--glass);border:2px solid rgba(255,255,255,0.3);cursor:pointer;font-size:20px;transition:all 0.3s}
.balance-card{background:var(--glass);backdrop-filter:blur(20px);border-radius:20px;padding:24px;margin-bottom:20px;border:1px solid rgba(255,255,255,0.15)}
.balance-label{font-size:14px;font-weight:600;opacity:0.9;margin-bottom:8px;display:flex;align-items:center;gap:8px}
.balance-amount{font-size:32px;font-weight:700;margin:12px 0;background:linear-gradient(135deg,#fff,#ffd700);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:16px;margin:20px 0}
.stat-card{background:var(--glass);padding:20px;border-radius:16px;border:1px solid rgba(255,255,255,0.15);text-align:center;transition:all 0.2s;cursor:pointer}
.stat-card:hover{transform:translateY(-4px)}
.actions{display:flex;gap:12px;margin:20px 0;flex-wrap:wrap}
.btn{flex:1;min-width:120px;padding:14px;border:none;border-radius:14px;font-weight:600;cursor:pointer;transition:all 0.3s;display:flex;align-items:center;justify-content:center;gap:8px;position:relative;z-index:10}
.btn-primary{background:var(--primary);color:#fff}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(63,81,181,0.4)}
.btn-secondary{background:var(--glass);border:2px solid rgba(255,255,255,0.3);color:#fff}
.btn-secondary:hover{background:rgba(255,255,255,0.2)}
.search-box{width:100%;padding:16px;border-radius:14px;border:2px solid rgba(255,255,255,0.2);background:var(--glass);color:#fff;font-size:16px;margin-bottom:20px}
.search-box:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(255,215,0,0.2)}
.transactions{background:var(--glass);padding:24px;border-radius:20px;border:1px solid rgba(255,255,255,0.15);margin-bottom:20px}
.transaction-item{display:flex;justify-content:space-between;align-items:center;padding:16px;border-radius:14px;margin-bottom:12px;background:rgba(255,255,255,0.08);cursor:pointer;transition:all 0.2s;position:relative;z-index:10}
.transaction-item:hover{background:rgba(255,255,255,0.15);transform:translateX(4px)}
.transaction-info{display:flex;gap:14px;align-items:center;flex:1}
.transaction-icon{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px}
.transaction-amount{font-size:18px;font-weight:700}
.positive{color:var(--success)}
.negative{color:var(--warning)}
.modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:1000;align-items:center;justify-content:center;padding:20px}
.modal.active{display:flex}
.modal-content{background:#fff;color:#1a237e;width:100%;max-width:500px;border-radius:20px;padding:30px;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.5);animation:slideIn 0.3s}
@keyframes slideIn{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}

/* NOUVEAU : BUDGET MODIFIABLE */
.budget-editor{background:var(--glass);padding:20px;border-radius:20px;border:2px solid rgba(255,215,0,0.3);margin:20px 0}
.budget-row{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.budget-row:last-child{margin-bottom:0}
.budget-cat{display:flex;align-items:center;gap:8px;font-weight:600;min-width:120px}
.budget-input{width:140px;padding:10px;border-radius:8px;border:2px solid rgba(255,255,255,0.3);background:rgba(255,255,255,0.1);color:#fff;font-size:14px;text-align:right}
.budget-input:focus{outline:none;border-color:var(--accent);background:#fff;color:#000}
.budget-save{position:sticky;bottom:20px;background:var(--accent);color:#000;font-weight:700;padding:12px 24px;border:none;border-radius:12px;cursor:pointer;transition:all 0.3s}
.budget-save:hover{transform:scale(1.05);box-shadow:0 8px 25px rgba(255,215,0,0.4)}
.budget-progress{width:100%;height:8px;background:rgba(255,255,255,0.2);border-radius:4px;margin-top:8px;overflow:hidden}
.budget-progress-fill{height:100%;background:linear-gradient(90deg,var(--success),var(--accent));border-radius:4px;transition:width 0.5s ease}
.form-group{margin-bottom:18px}
.form-group label{font-weight:600;font-size:15px;display:block;margin-bottom:8px}
.form-group input,.form-group select{width:100%;padding:14px;border-radius:12px;border:2px solid rgba(26,35,126,0.2);font-size:16px;background:#fff}
.form-group input:focus,.form-group select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(63,81,181,0.1)}
.category-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(70px,1fr));gap:12px;margin-top:12px}
.category-btn{padding:16px;border-radius:14px;border:2px solid rgba(26,35,126,0.3);cursor:pointer;font-size:24px;text-align:center;transition:all 0.2s;background:rgba(255,255,255,0.1);position:relative;z-index:10}
.category-btn:hover{transform:scale(1.05);background:rgba(63,81,181,0.2)}
.category-btn.active{border-color:var(--accent);background:rgba(255,215,0,0.3);transform:scale(1.1)}
.cat-info{font-size:13px;margin-top:8px;padding:12px;background:rgba(63,81,181,0.1);border-radius:10px;border-left:4px solid var(--accent)}
.profile-badges{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
.profile-badge{padding:12px 16px;border-radius:25px;border:2px solid rgba(255,255,255,0.4);font-size:13px;font-weight:600;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:6px;position:relative;z-index:10}
.profile-badge:hover{background:rgba(255,255,255,0.2);transform:translateY(-2px)}
.profile-badge.active{background:rgba(255,215,0,0.3);border-color:var(--accent)}
.chart-container{background:var(--glass);border-radius:20px;padding:20px;margin:20px 0;border:1px solid rgba(255,255,255,0.15)}
.toast{position:fixed;top:24px;right:24px;background:var(--success);color:#fff;padding:16px 24px;border-radius:12px;z-index:2000;font-weight:600;transform:translateX(400px);transition:all 0.4s}
.toast.show{transform:translateX(0)}
.suggestion-item{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid rgba(255,255,255,0.1);transition:all 0.2s;cursor:pointer}
.suggestion-item:hover{background:rgba(255,255,255,0.1)}
.suggestion-item input{width:120px;padding:8px;border-radius:8px;border:2px solid rgba(255,215,0,0.5);background:#fff;color:#000;font-size:14px;text-align:right}
.suggestion-item input:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(255,215,0,0.2)}
.switch{position:relative;display:inline-block;width:60px;height:34px}
.switch input{opacity:0;width:0;height:0}
.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#ccc;transition:0.4s;border-radius:34px}
.slider:before{position:absolute;content:"";height:26px;width:26px;left:4px;bottom:4px;background:#fff;transition:0.4s;border-radius:50%}
input:checked+.slider{background:var(--primary)}
input:checked+.slider:before{transform:translateX(26px)}
@media(max-width:768px){.actions{flex-direction:column}.btn{flex:1}.budget-row{flex-direction:column;align-items:flex-start;gap:8px}}
</style>
</head>
<body>
<div class="container">
<header>
<h1>üíº Budget Pro AI+ (MODIFIABLE)</h1>
<button class="theme-toggle" id="themeToggle" onclick="toggleTheme()">üåô</button>
</header>

<!-- CONFIG -->
<div class="balance-card">
<div class="balance-label">‚öôÔ∏è Configuration</div>
<div class="form-group">
<label>Budget mensuel (Ar)</label>
<input type="number" id="monthlyBudget" min="0" placeholder="500000" oninput="saveConfig()">
</div>
<div class="form-group">
<label>Personnes au foyer</label>
<input type="number" id="peopleCount" min="1" value="1" max="10" oninput="saveConfig()">
</div>
<div class="form-group">
<label>Paye loyer?</label>
<div style="display:flex;align-items:center;gap:12px">
<input type="checkbox" id="payRent" onchange="saveConfig()">
<span style="font-size:14px">Oui</span>
</div>
</div>
<div class="form-group">
<label>Profil</label>
<div class="profile-badges">
<button class="profile-badge active" onclick="selectProfile('balanced')">‚öñÔ∏è √âquilibr√©</button>
<button class="profile-badge" onclick="selectProfile('security')">üõ°Ô∏è S√©curit√©</button>
<button class="profile-badge" onclick="selectProfile('comfort')">üéâ Confort</button>
</div>
</div>
</div>

<!-- STATS -->
<div class="stats-grid">
<div class="stat-card"><div class="balance-label">üí∞ Budget total</div><div class="balance-amount" id="totalBudget">0 Ar</div></div>
<div class="stat-card"><div class="balance-label">üíµ Solde actuel</div><div class="balance-amount" id="balance">0 Ar</div></div>
<div class="stat-card"><div class="balance-label">üíé √âpargne</div><div class="balance-amount" id="savings">0 Ar</div></div>
<div class="stat-card"><div class="balance-label">‚ö†Ô∏è Reste √† vivre</div><div class="balance-amount" id="resteAVivre">0 Ar</div></div>
</div>

<!-- ACTIONS -->
<div class="actions">
<button class="btn btn-primary" onclick="openModal()">‚ûï Nouvelle transaction</button>
<button class="btn btn-secondary" onclick="exportData()">üìä Exporter</button>
<button class="btn btn-secondary" onclick="resetData()">üßπ Reset</button>
<button class="btn btn-secondary" onclick="generateReport()">üìà Rapport</button>
</div>

<input class="search-box" id="searchInput" placeholder="üîç Recherche transactions..." oninput="renderTransactions()">

<!-- üéØ NOUVEAU : BUDGET PERSONNALISABLE -->
<div class="budget-editor">
<h3 style="margin-bottom:16px;font-size:20px">‚úèÔ∏è Budget personnalis√© (modifiable)</h3>
<div id="customBudgetList"></div>
<button class="budget-save" onclick="saveCustomBudget()">üíæ Sauvegarder mes budgets</button>
</div>

<!-- CHART -->
<div class="chart-container">
<canvas id="expensesChart" width="400" height="200"></canvas>
</div>

<!-- SUGGESTIONS MODIFIABLES -->
<div class="balance-card">
<h3 style="margin-bottom:16px">üí° Budget sugg√©r√© (cliquez pour modifier)</h3>
<div id="suggestionList"></div>
</div>

<!-- TRANSACTIONS -->
<div class="transactions">
<h3 style="margin-bottom:20px">üìã Transactions r√©centes</h3>
<div id="transactionsList">Aucune transaction</div>
</div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- MODAL (inchang√©e) -->
<div class="modal" id="transactionModal">
<div class="modal-content">
<h2 id="modalTitle">‚ûï Nouvelle transaction</h2>
<form onsubmit="addTransaction(event)">
<div class="form-group">
<label>Type</label>
<select id="transactionType" onchange="updateCategories()">
<option value="expense">üí∏ D√©pense</option>
<option value="income">üí∞ Revenu</option>
</select>
</div>
<div class="form-group">
<label>Montant (Ar)</label>
<input type="number" id="amount" required min="0" placeholder="15000">
</div>
<div class="form-group">
<label>Description</label>
<input type="text" id="description" required placeholder="Courses, salaire...">
</div>
<div class="form-group">
<label>Cat√©gorie</label>
<div class="category-grid" id="categoryGrid"></div>
<div id="categoryInfo" class="cat-info">‚ö†Ô∏è Cliquez sur une ic√¥ne</div>
</div>
<div style="display:flex;gap:16px">
<button class="btn btn-primary" type="submit">‚úÖ Enregistrer</button>
<button type="button" class="btn btn-secondary" onclick="closeModal()">‚ùå Annuler</button>
</div>
</form>
</div>
</div>

<script>
// VARIABLES GLOBALES (ajout budget personnalis√©)
let transactions = JSON.parse(localStorage.getItem('budgetProTransactions') || '[]');
let savings = parseFloat(localStorage.getItem('budgetProSavings') || '0');
let monthlyBudget = Number(localStorage.getItem('budgetProMonthly') || 0);
let peopleCount = Number(localStorage.getItem('budgetProPeople') || 1);
let payRent = localStorage.getItem('budgetProRent') === 'true';
let selectedProfile = localStorage.getItem('budgetProProfile') || 'balanced';
let selectedCategory = -1;
let chart = null;
let customBudget = JSON.parse(localStorage.getItem('budgetProCustomBudget') || '{}'); // NOUVEAU

// CAT√âGORIES BASE
const baseCategories = ['Nourriture', 'Transport', 'Logement', '√âpargne', 'Sant√©', 'Internet', '√ânergie', 'Loisirs'];

// INIT
document.addEventListener('DOMContentLoaded', function() {
    loadUI();
    renderAll();
    renderCustomBudget();
});

function formatAr(v) {
    return new Intl.NumberFormat('fr-FR').format(Math.round(v)) + ' Ar';
}

function showToast(message) {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 3000);
}

// ... (fonctions existantes inchang√©es : loadUI, toggleTheme, etc.)
function loadUI() {
    document.getElementById('monthlyBudget').value = monthlyBudget;
    document.getElementById('peopleCount').value = peopleCount;
    document.getElementById('payRent').checked = payRent;
    document.querySelectorAll('.profile-badge').forEach(btn => {
        const profile = btn.textContent.includes('√âquilibr√©') ? 'balanced' : btn.textContent.includes('S√©curit√©') ? 'security' : 'comfort';
        btn.classList.toggle('active', profile === selectedProfile);
    });
    const isLight = localStorage.getItem('budgetProTheme') === 'light';
    if (isLight) document.body.classList.add('light');
    document.getElementById('themeToggle').textContent = isLight ? 'üåô' : '‚òÄÔ∏è';
}

function toggleTheme() {
    document.body.classList.toggle('light');
    const isLight = document.body.classList.contains('light');
    localStorage.setItem('budgetProTheme', isLight ? 'light' : 'dark');
    document.getElementById('themeToggle').textContent = isLight ? 'üåô' : '‚òÄÔ∏è';
    showToast('Th√®me chang√© !');
}

function selectProfile(profile) {
    selectedProfile = profile;
    localStorage.setItem('budgetProProfile', profile);
    document.querySelectorAll('.profile-badge').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    renderSuggestions();
    renderCustomBudget();
    showToast(`Profil ${profile} activ√©`);
}

function saveConfig() {
    monthlyBudget = Number(document.getElementById('monthlyBudget').value) || 0;
    peopleCount = Number(document.getElementById('peopleCount').value) || 1;
    payRent = document.getElementById('payRent').checked;
    localStorage.setItem('budgetProMonthly', monthlyBudget);
    localStorage.setItem('budgetProPeople', peopleCount);
    localStorage.setItem('budgetProRent', payRent);
    renderAll();
    showToast('Config sauvegard√©e');
}

// üéØ NOUVEAU : RENDER BUDGET PERSONNALISABLE
function renderCustomBudget() {
    const container = document.getElementById('customBudgetList');
    let html = '';
    
    baseCategories.forEach(cat => {
        const budget = customBudget[cat] || 0;
        const totalBudget = getTotalBudget();
        const percent = totalBudget > 0 ? (budget / totalBudget * 100) : 0;
        const spent = getSpentByCategory(cat);
        const progress = totalBudget > 0 ? (spent / budget * 100) : 0;
        
        html += `
        <div class="budget-row">
            <div class="budget-cat">
                <span>${getIcon(cat)}</span>
                <span>${cat}</span>
            </div>
            <input type="number" class="budget-input" value="${budget}" 
                   onchange="updateCustomBudget('${cat}', this.value)" 
                   placeholder="0" min="0">
            <div style="flex:1;min-width:100px;text-align:right">
                <div style="font-size:12px;opacity:0.8">D√©pens√©: ${formatAr(spent)}</div>
                <div class="budget-progress">
                    <div class="budget-progress-fill" style="width:${Math.min(progress,100)}%"></div>
                </div>
            </div>
        </div>`;
    });
    
    container.innerHTML = html;
}

function getIcon(cat) {
    const icons = {
        'Nourriture': 'üçî', 'Transport': 'üöó', 'Logement': 'üè†', '√âpargne': 'üíé',
        'Sant√©': '‚ù§Ô∏è', 'Internet': 'üì±', '√ânergie': 'üí°', 'Loisirs': 'üéâ'
    };
    return icons[cat] || 'üìä';
}

function updateCustomBudget(category, value) {
    customBudget[category] = Number(value) || 0;
    localStorage.setItem('budgetProCustomBudget', JSON.stringify(customBudget));
    renderCustomBudget();
    updateStats();
    showToast(`Budget ${category} mis √† jour`);
}

function saveCustomBudget() {
    localStorage.setItem('budgetProCustomBudget', JSON.stringify(customBudget));
    renderAll();
    showToast('‚úÖ Tous les budgets sauvegard√©s !');
}

function getSpentByCategory(category) {
    return Math.abs(transactions
        .filter(t => t.category === category && t.amount < 0)
        .reduce((sum, t) => sum + t.amount, 0));
}

// MODIFI√â : Suggestions avec inputs modifiables
function renderSuggestions() {
    const total = getTotalBudget();
    if (total <= 0) {
        document.getElementById('suggestionList').innerHTML = '<div style="text-align:center;padding:20px;color:rgba(255,255,255,0.6)">üí° Entrez un budget pour les suggestions</div>';
        return;
    }
    
    const profiles = {
        balanced: {Nourriture:0.25, Transport:0.12, Logement:payRent?0.35:0, √âpargne:0.20, Sant√©:0.08},
        security: {Nourriture:0.30, Transport:0.10, Logement:payRent?0.30:0, √âpargne:0.25, Sant√©:0.10},
        comfort: {Nourriture:0.22, Transport:0.15, Logement:payRent?0.38:0, √âpargne:0.15, Loisirs:0.10}
    };
    
    const profile = profiles[selectedProfile];
    let html = '';
    
    Object.entries(profile).forEach(([cat, pct]) => {
        if (pct > 0) {
            const suggested = total * pct;
            const custom = customBudget[cat] || suggested;
            html += `
            <div class="suggestion-item" onclick="this.querySelector('input').focus()">
                <span>${getIcon(cat)} ${cat}</span>
                <input type="number" value="${custom}" onchange="updateCustomBudget('${cat}', this.value)" 
                       placeholder="${formatAr(suggested)}" min="0">
            </div>`;
        }
    });
    
    document.getElementById('suggestionList').innerHTML = html;
}

// ... (reste des fonctions inchang√©es : getTotalBudget, updateStats, etc.)
function getTotalBudget() {
    const income = transactions.filter(t => t.amount > 0).reduce((s, t) => s + t.amount, 0);
    return monthlyBudget + income;
}

function updateStats() {
    const balance = transactions.reduce((s, t) => s + t.amount, 0);
    const resteAVivre = balance - savings;
    const minReste = 50000 * peopleCount;
    
    let totalCustomBudget = 0;
    baseCategories.forEach(cat => totalCustomBudget += customBudget[cat] || 0);
    
    document.getElementById('totalBudget').textContent = formatAr(getTotalBudget());
    document.getElementById('balance').textContent = formatAr(balance);
    document.getElementById('savings').textContent = formatAr(savings);
    document.getElementById('resteAVivre').textContent = formatAr(resteAVivre);
    document.getElementById('resteAVivre').style.color = resteAVivre < minReste ? '#ff6b6b' : '#4ecdc4';
}

function renderAll() {
    updateStats();
    renderTransactions();
    renderSuggestions();
    renderCustomBudget();
    updateChart();
}

// ... (autres fonctions inchang√©es)
function getCategories(type) {
    return type === 'expense' ? 
        [{icon:'üçî',name:'Nourriture',color:'#ff6b6b'},{icon:'üöó',name:'Transport',color:'#4ecdc4'},{icon:'üè†',name:'Logement',color:'#95e1d3'},{icon:'üì±',name:'Internet',color:'#ffd93d'},{icon:'üí°',name:'√ânergie',color:'#f8b400'},{icon:'‚ù§Ô∏è',name:'Sant√©',color:'#ff9ff3'}] :
        [{icon:'üí∞',name:'Salaire',color:'#4ecdc4'},{icon:'üìà',name:'Business',color:'#ffd93d'},{icon:'üéÅ',name:'Autres',color:'#95e1d3'}];
}

function updateCategories() {
    const type = document.getElementById('transactionType').value;
    const cats = getCategories(type);
    document.getElementById('categoryGrid').innerHTML = cats.map((c, i) => 
        `<button class="category-btn ${i === selectedCategory ? 'active' : ''}" onclick="selectCategory(${i})" title="${c.name}">${c.icon}</button>`
    ).join('');
    const info = document.getElementById('categoryInfo');
    info.textContent = selectedCategory >= 0 && selectedCategory < cats.length ? 
        `‚úÖ ${cats[selectedCategory].name}` : '‚ö†Ô∏è Cliquez sur une ic√¥ne';
}

function selectCategory(index) {
    selectedCategory = index;
    updateCategories();
}

function openModal() { /* ... m√™me code ... */ }
function closeModal() { /* ... m√™me code ... */ }
function addTransaction(e) { /* ... m√™me code ... */ }
function renderTransactions() { /* ... m√™me code ... */ }
function updateChart() { /* ... m√™me code ... */ }
function deleteTransaction(id) { /* ... m√™me code ... */ }
function exportData() { /* ... m√™me code ... */ }
function resetData() { /* ... m√™me code ... */ }
function generateReport() { /* ... m√™me code ... */ }
</script>
</body>
</html>
