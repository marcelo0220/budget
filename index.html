<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Budget Pro AI - Corrig√©</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
* {margin:0;padding:0;box-sizing:border-box}
:root {
  --primary: linear-gradient(135deg,#1a237e,#3f51b5);
  --accent: #ffd700;
  --glass: rgba(255,255,255,.1);
  --success: #4ecdc4;
  --warning: #ff6b6b;
}
body {
  font-family: 'Inter', sans-serif;
  background: linear-gradient(135deg,#0a0e27,#1a237e);
  color: #fff;
  min-height: 100vh;
}
.container {max-width: 1200px; margin: auto; padding: 20px}
.balance-card {
  background: var(--glass);
  backdrop-filter: blur(20px);
  border-radius: 24px;
  padding: 24px;
  margin-bottom: 18px;
  border: 1px solid rgba(255,255,255,.2);
}
.balance-label {opacity: .8; font-weight: 600; font-size: 13px}
.balance-amount {
  font-size: 32px; font-weight: 700; margin: 10px 0;
  background: linear-gradient(135deg,#fff,var(--accent));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
.stats-grid {
  display: grid; grid-template-columns: repeat(auto-fit,minmax(150px,1fr));
  gap: 15px; margin-bottom: 20px;
}
.stat-card {
  background: var(--glass); padding: 16px; border-radius: 16px;
  border: 1px solid rgba(255,255,255,.2);
}
.actions {display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap}
.btn {
  flex: 1; min-width: 120px; padding: 12px; border: none;
  border-radius: 14px; font-weight: 600; cursor: pointer;
}
.btn-primary {background: var(--primary); color: #fff}
.btn-secondary {background: var(--glass); border: 1px solid rgba(255,255,255,.2); color: #fff}
.search-box {
  width: 100%; padding: 12px; border-radius: 14px;
  border: 1px solid rgba(255,255,255,.2); background: var(--glass);
  color: #fff; margin-bottom: 18px;
}
.transaction-item {
  display: flex; justify-content: space-between; align-items: center;
  padding: 12px; border-radius: 12px; margin-bottom: 8px;
  background: rgba(255,255,255,.05); cursor: pointer;
}
.modal {
  display: none; position: fixed; inset: 0; background: rgba(0,0,0,.8);
  backdrop-filter: blur(10px); align-items: flex-end; z-index: 20;
}
.modal-content {
  background: #fff; color: #1a237e; width: 100%; max-width: 600px;
  margin: auto; border-radius: 24px 24px 0 0; padding: 24px;
  max-height: 90vh; overflow-y: auto;
}
.form-group {margin-bottom: 14px}
.form-group label {font-weight: 600; font-size: 14px; display: block; margin-bottom: 4px}
.form-group input, .form-group select {
  width: 100%; padding: 10px; border-radius: 12px; border: 2px solid rgba(26,35,126,.2)
}
.category-grid {display: grid; grid-template-columns: repeat(4,1fr); gap: 8px; margin-top: 8px}
.category-btn {
  padding: 10px; border-radius: 12px; border: 2px solid rgba(26,35,126,.2);
  cursor: pointer; font-size: 20px; text-align: center; transition: all .2s;
}
.category-btn:hover {background: rgba(63,81,181,.1)}
.category-btn.active {border-color: var(--accent); background: rgba(255,215,0,.2); transform: scale(1.05)}
.cat-info {font-size: 12px; opacity: .8; margin-top: 5px; padding: 6px; background: rgba(63,81,181,.1); border-radius: 6px}
.toast {
  position: fixed; top: 20px; right: 20px; padding: 16px 20px;
  border-radius: 12px; z-index: 100; display: none; color: white;
}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>Budget Pro</h1>
    <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
  </header>

  <!-- CONFIG -->
  <div class="balance-card">
    <div class="balance-label">Configuration</div>
    <div class="form-group">
      <label>Budget pr√©vu (Ar)</label>
      <input type="number" id="monthlyBudget" oninput="saveConfig()">
    </div>
    <div class="form-group">
      <label>Personnes</label>
      <input type="number" id="peopleCount" min="1" value="1" oninput="saveConfig()">
    </div>
    <div class="form-group">
      <label>Paye loyer?</label>
      <input type="checkbox" id="payRent" onchange="saveConfig()">
    </div>
  </div>

  <!-- STATS PRINCIPALES -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="balance-label">Budget total</div>
      <div class="balance-amount" id="totalBudget">0 Ar</div>
    </div>
    <div class="stat-card">
      <div class="balance-label">Solde actuel</div>
      <div class="balance-amount" id="balance">0 Ar</div>
    </div>
    <div class="stat-card">
      <div class="balance-label">√âpargne</div>
      <div class="balance-amount" id="savings">0 Ar</div>
    </div>
  </div>

  <!-- ACTIONS -->
  <div class="actions">
    <button class="btn btn-primary" onclick="openModal()">‚ûï Ajouter</button>
    <button class="btn btn-secondary" onclick="exportData()">üìä Export</button>
    <button class="btn btn-secondary" onclick="resetData()">üßπ Reset</button>
  </div>

  <input class="search-box" placeholder="üîç Rechercher..." id="search" oninput="renderTransactions()">

  <!-- SUGGESTIONS -->
  <div class="balance-card">
    <h3>üí° Suggestions (clique pour modifier)</h3>
    <div id="suggestionList"></div>
  </div>

  <!-- TRANSACTIONS -->
  <div class="balance-card">
    <h3>Transactions</h3>
    <div id="transactionsList"></div>
  </div>
</div>

<!-- MODAL TRANSACTION -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h2>Nouvelle transaction</h2>
    <form onsubmit="addTransaction(event)">
      <div class="form-group">
        <label>Type</label>
        <select id="type" onchange="updateCategories()">
          <option value="expense">D√©pense</option>
          <option value="income">Revenu</option>
        </select>
      </div>
      <div class="form-group">
        <label>Montant (Ar)</label>
        <input type="number" id="amount" required min="0">
      </div>
      <div class="form-group">
        <label>Description</label>
        <input type="text" id="description" required>
      </div>
      <div class="form-group">
        <label>Cat√©gorie</label>
        <div class="category-grid" id="categories"></div>
        <div id="selectedCatInfo" class="cat-info">‚ö†Ô∏è Cliquez sur une ic√¥ne</div>
      </div>
      <div style="display:flex;gap:10px">
        <button class="btn btn-primary" type="submit">‚úÖ Valider</button>
        <button type="button" class="btn btn-secondary" onclick="closeModal()">‚ùå Annuler</button>
      </div>
    </form>
  </div>
</div>

<!-- TOAST -->
<div class="toast success" id="toast"></div>

<script>
const MIN_RESTE_A_VIVRE = 50000;
const MAX_SAVINGS_RATE = 0.2;

// DONN√âES PERSISTANTES
let transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
let savings = parseFloat(localStorage.getItem('savings') || '0');
let monthlyBudget = Number(localStorage.getItem('monthlyBudget') || 0);
let peopleCount = Number(localStorage.getItem('peopleCount') || 1);
let payRent = localStorage.getItem('payRent') === 'true';

// CAT√âGORIES
const expenseCategories = [
  {icon:'üçî',name:'Nourriture',color:'#ff6b6b'},
  {icon:'üöó',name:'Transport',color:'#4ecdc4'},
  {icon:'üè†',name:'Logement',color:'#95e1d3'},
  {icon:'üì±',name:'Internet',color:'#ffd93d'}
];
const incomeCategories = [
  {icon:'üí∞',name:'Salaire',color:'#4ecdc4'},
  {icon:'üìà',name:'Business',color:'#ffd93d'}
];

let selectedCategoryIndex = -1;

function formatAr(v) {
  return new Intl.NumberFormat('fr-FR').format(v) + ' Ar';
}

function showToast(message, type = 'success') {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.className = `toast ${type}`;
  toast.style.display = 'block';
  setTimeout(() => toast.style.display = 'none', 3000);
}

function updateCategories() {
  const type = document.getElementById('type').value;
  const grid = document.getElementById('categories');
  const info = document.getElementById('selectedCatInfo');
  const cats = type === 'expense' ? expenseCategories : incomeCategories;
  
  grid.innerHTML = cats.map((c, i) => 
    `<div class="category-btn ${i === selectedCategoryIndex ? 'active' : ''}" 
       onclick="selectCategory(${i})" title="${c.name}">${c.icon}</div>`
  ).join('');
  
  if (selectedCategoryIndex >= 0 && selectedCategoryIndex < cats.length) {
    info.textContent = `‚úÖ ${cats[selectedCategoryIndex].name} s√©lectionn√©e`;
  } else {
    info.textContent = '‚ö†Ô∏è Cliquez sur une ic√¥ne pour s√©lectionner';
  }
}

function selectCategory(index) {
  selectedCategoryIndex = index;
  updateCategories();
}

function openModal() {
  document.getElementById('modal').style.display = 'flex';
  selectedCategoryIndex = -1;
  document.getElementById('amount').value = '';
  document.getElementById('description').value = '';
  updateCategories();
}

function closeModal() {
  document.getElementById('modal').style.display = 'none';
  selectedCategoryIndex = -1;
}

function addTransaction(e) {
  e.preventDefault();
  
  if (selectedCategoryIndex === -1) {
    showToast('‚ö†Ô∏è Choisissez une cat√©gorie !', 'warning');
    return;
  }
  
  const type = document.getElementById('type').value;
  const amount = Number(document.getElementById('amount').value);
  const desc = document.getElementById('description').value;
  
  const cats = type === 'expense' ? expenseCategories : incomeCategories;
  const cat = cats[selectedCategoryIndex];
  const value = type === 'expense' ? -amount : amount;
  
  let finalAmount = value;
  let savingsText = '';
  
  if (type === 'income') {
    const maxSavings = amount * MAX_SAVINGS_RATE;
    const currentBalance = transactions.reduce((s, t) => s + t.amount, 0);
    const projectedBalance = currentBalance + value;
    
    let effectiveSavings = 0;
    if (projectedBalance - maxSavings >= MIN_RESTE_A_VIVRE) {
      effectiveSavings = maxSavings;
    }
    
    savings += effectiveSavings;
    finalAmount = value - effectiveSavings;
    savingsText = effectiveSavings > 0 ? ` (√©pargne: ${formatAr(effectiveSavings)})` : '';
    localStorage.setItem('savings', savings);
  }
  
  transactions.unshift({
    id: Date.now(),
    amount: finalAmount,
    description: desc + savingsText,
    icon: cat.icon,
    category: cat.name,
    color: cat.color || '#4ecdc4',
    date: new Date()
  });
  
  localStorage.setItem('transactions', JSON.stringify(transactions));
  closeModal();
  renderAll();
  showToast('‚úÖ Transaction ajout√©e !');
}

function renderTransactions() {
  const search = document.getElementById('search').value.toLowerCase();
  const list = document.getElementById('transactionsList');
  
  const filtered = transactions.filter(t => 
    t.description.toLowerCase().includes(search) || 
    t.category.toLowerCase().includes(search)
  ).slice(0, 10);
  
  list.innerHTML = filtered.map(t => `
    <div class="transaction-item" onclick="deleteTransaction(${t.id})">
      <div style="display:flex;gap:12px;align-items:center">
        <div class="transaction-icon" style="background:${t.color}20">${t.icon}</div>
        <div>
          ${t.description}
          <br><small>${t.category} ¬∑ ${new Date(t.date).toLocaleDateString('fr-FR')}</small>
        </div>
      </div>
      <div style="color:${t.amount > 0 ? '#4ecdc4' : '#ff6b6b'}; font-weight:600">
        ${t.amount > 0 ? '+' : ''}${formatAr(Math.abs(t.amount))}
      </div>
    </div>
  `).join('') || '<p>Aucune transaction</p>';
}

function updateStats() {
  const balance = transactions.reduce((s, t) => s + t.amount, 0);
  const income = transactions.filter(t => t.amount > 0).reduce((s, t) => s + t.amount, 0);
  const expenses = Math.abs(transactions.filter(t => t.amount < 0).reduce((s, t) => s + t.amount, 0));
  const totalBudget = monthlyBudget + income;
  
  document.getElementById('totalBudget').textContent = formatAr(totalBudget);
  document.getElementById('balance').textContent = formatAr(balance);
  document.getElementById('savings').textContent = formatAr(savings);
}

function renderAll() {
  renderTransactions();
  updateStats();
}

function deleteTransaction(id) {
  if (confirm('Supprimer cette transaction ?')) {
    transactions = transactions.filter(t => t.id !== id);
    localStorage.setItem('transactions', JSON.stringify(transactions));
    renderAll();
    showToast('üóëÔ∏è Transaction supprim√©e');
  }
}

function saveConfig() {
  monthlyBudget = Number(document.getElementById('monthlyBudget').value || 0);
  peopleCount = Number(document.getElementById('peopleCount').value || 1);
  payRent = document.getElementById('payRent').checked;
  
  localStorage.setItem('monthlyBudget', monthlyBudget);
  localStorage.setItem('peopleCount', peopleCount);
  localStorage.setItem('payRent', payRent);
  
  renderAll();
  showToast('‚öôÔ∏è Configuration sauvegard√©e');
}

function exportData() {
  const data = {transactions, savings, monthlyBudget, peopleCount, payRent};
  const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'budget.json';
  a.click();
  showToast('üìä Donn√©es export√©es');
}

function resetData() {
  if (confirm('R√©initialiser TOUTES les donn√©es ?')) {
    transactions = [];
    savings = 0;
    localStorage.clear();
    renderAll();
    showToast('üßπ Donn√©es r√©initialis√©es', 'warning');
  }
}

function toggleTheme() {
  document.body.classList.toggle('light');
}

// INITIALISATION
document.getElementById('monthlyBudget').value = monthlyBudget;
document.getElementById('peopleCount').value = peopleCount;
document.getElementById('payRent').checked = payRent;

renderAll();
</script>
</body>
</html>
