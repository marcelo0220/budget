<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Budget Pro AI+ ‚úÖ + NOUVELLE CAT√âGORIE</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* CSS existant + NOUVEAU MODAL CATEGORIE */
*{margin:0;padding:0;box-sizing:border-box}
:root{--primary:#3f51b5;--accent:#ffd700;--glass:rgba(255,255,255,0.1);--success:#4ecdc4;--warning:#ff6b6b;--danger:#ef4444;--bg-dark:linear-gradient(135deg,#0a0e17,#1a237e);--radius:16px}
body{font-family:'Inter',sans-serif;background:var(--bg-dark);color:#fff;min-height:100vh}
/* ... (tout le CSS pr√©c√©dent reste identique) ... */
.category-modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:2000;align-items:center;justify-content:center;padding:20px}
.category-modal.active{display:flex}
.category-modal-content{background:#fff;color:#1a237e;width:100%;max-width:450px;border-radius:20px;padding:30px;max-height:80vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.5);animation:slideIn 0.3s}
.new-cat-icon-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:12px;margin:16px 0}
.new-cat-icon-btn{padding:16px;border-radius:14px;border:2px solid rgba(26,35,126,0.3);cursor:pointer;font-size:24px;text-align:center;transition:all 0.2s;background:rgba(255,255,255,0.1)}
.new-cat-icon-btn:hover{transform:scale(1.1);background:rgba(63,81,181,0.2)}
.new-cat-icon-btn.active{border-color:var(--accent);background:rgba(255,215,0,0.3)}
/* ... reste du CSS identique ... */
</style>
</head>
<body>
<!-- HTML existant + NOUVEAU BOUTON + MODAL -->
<div class="container">
<!-- ... header, config, stats, actions existants ... -->

<!-- ACTIONS avec NOUVEAU BOUTON -->
<div class="actions">
<button class="btn btn-primary" onclick="openModal()">‚ûï Nouvelle transaction</button>
<button class="btn btn-secondary" onclick="openCategoryModal()">‚≠ê Nouvelle cat√©gorie</button> <!-- ‚úÖ NOUVEAU -->
<button class="btn btn-secondary" onclick="exportData()">üìä Exporter</button>
<button class="btn btn-secondary" onclick="resetData()">üßπ Reset</button>
</div>

<!-- ... search, chart, suggestions, transactions existants ... -->
</div>

<!-- MODAL CATEGORIE NOUVEAU ‚úÖ -->
<div class="category-modal" id="categoryModal">
<div class="category-modal-content">
<h2>‚≠ê Nouvelle cat√©gorie personnalis√©e</h2>
<form onsubmit="addCustomCategory(event)">
<div class="form-group">
<label>Nom de la cat√©gorie</label>
<input type="text" id="newCategoryName" required placeholder="Ex: Cin√©ma, Vacances...">
</div>
<div class="form-group">
<label>Ic√¥ne</label>
<div class="new-cat-icon-grid" id="newCategoryIcons"></div>
<div id="selectedIconInfo" class="cat-info">‚ö†Ô∏è Cliquez sur une ic√¥ne</div>
</div>
<div class="form-group">
<label>Couleur</label>
<input type="color" id="newCategoryColor" value="#ff9ff3">
</div>
<div style="display:flex;gap:16px">
<button class="btn btn-primary" type="submit">‚úÖ Cr√©er cat√©gorie</button>
<button type="button" class="btn btn-secondary" onclick="closeCategoryModal()">‚ùå Annuler</button>
</div>
</form>
</div>
</div>

<!-- MODAL TRANSACTION (existant) -->
<div class="modal" id="transactionModal">...</div>

<script>
// VARIABLES GLOBALES + NOUVEAU
let transactions = JSON.parse(localStorage.getItem('budgetProTransactions') || '[]');
let savings = parseFloat(localStorage.getItem('budgetProSavings') || '0');
let monthlyBudget = Number(localStorage.getItem('budgetProMonthly') || 0);
let peopleCount = Number(localStorage.getItem('budgetProPeople') || 1);
let payRent = localStorage.getItem('budgetProRent') === 'true';
let selectedProfile = localStorage.getItem('budgetProProfile') || 'balanced';
let selectedCategory = -1;
let chart = null;
let customBudget = JSON.parse(localStorage.getItem('budgetProCustomBudget') || '{}');
let customCategories = JSON.parse(localStorage.getItem('budgetProCustomCategories') || '[]'); // ‚úÖ NOUVEAU
let selectedNewCategoryIcon = ''; // ‚úÖ NOUVEAU

// IC√îNES DISPONIBLES POUR NOUVELLES CAT√âGORIES
const availableIcons = ['üé¨','‚úàÔ∏è','üëï','üíÑ','üìö','üéÆ','üèãÔ∏è','üç∑','üé™','üõí','üîß','üéì','üíª','üé∏','üè†','üö≤','üë®‚Äçüë©‚Äçüëß','üê∂','üå±','‚öΩ'];

// INIT
document.addEventListener('DOMContentLoaded', function() {
    loadUI();
    renderAll();
    renderNewCategoryIcons();
});

// ‚úÖ NOUVEAU : OUVRIR MODAL CAT√âGORIE
function openCategoryModal() {
    document.getElementById('categoryModal').classList.add('active');
    document.getElementById('newCategoryName').value = '';
    document.getElementById('newCategoryColor').value = '#ff9ff3';
    selectedNewCategoryIcon = '';
    document.body.style.overflow = 'hidden';
    renderNewCategoryIcons();
}

// ‚úÖ FERMER MODAL CAT√âGORIE
function closeCategoryModal() {
    document.getElementById('categoryModal').classList.remove('active');
    document.body.style.overflow = '';
}

// ‚úÖ RENDRE IC√îNES S√âLECTIONNABLES
function renderNewCategoryIcons() {
    const grid = document.getElementById('newCategoryIcons');
    grid.innerHTML = availableIcons.map((icon, i) => 
        `<button type="button" class="new-cat-icon-btn ${icon === selectedNewCategoryIcon ? 'active' : ''}" 
                onclick="selectNewCategoryIcon('${icon}')" title="Ic√¥ne ${icon}">
            ${icon}
        </button>`
    ).join('');
}

// ‚úÖ S√âLECTIONNER IC√îNE
function selectNewCategoryIcon(icon) {
    selectedNewCategoryIcon = icon;
    renderNewCategoryIcons();
    document.getElementById('selectedIconInfo').textContent = `‚úÖ ${icon} s√©lectionn√©e`;
}

// ‚úÖ AJOUTER NOUVELLE CAT√âGORIE
function addCustomCategory(e) {
    e.preventDefault();
    
    if (!selectedNewCategoryIcon) {
        showToast('‚ö†Ô∏è Choisissez une ic√¥ne !', 'warning');
        return;
    }
    
    const name = document.getElementById('newCategoryName').value.trim();
    const color = document.getElementById('newCategoryColor').value;
    
    if (customCategories.find(cat => cat.name.toLowerCase() === name.toLowerCase())) {
        showToast('‚ö†Ô∏è Cette cat√©gorie existe d√©j√† !', 'warning');
        return;
    }
    
    const newCategory = {
        id: Date.now(),
        name: name,
        icon: selectedNewCategoryIcon,
        color: color
    };
    
    customCategories.unshift(newCategory);
    localStorage.setItem('budgetProCustomCategories', JSON.stringify(customCategories));
    
    // ‚úÖ Ajouter au budget personnalis√© par d√©faut
    customBudget[name] = 0;
    localStorage.setItem('budgetProCustomBudget', JSON.stringify(customBudget));
    
    closeCategoryModal();
    renderAll();
    showToast(`‚úÖ "${name}" ajout√©e ! ‚≠ê`);
}

// ‚úÖ MODIFI√â : getCategories() inclut cat√©gories personnalis√©es
function getCategories(type) {
    const baseExpense = [
        {icon:'üçî',name:'Nourriture',color:'#ff6b6b'},
        {icon:'üöó',name:'Transport',color:'#4ecdc4'},
        {icon:'üè†',name:'Logement',color:'#95e1d3'},
        {icon:'üì±',name:'Internet',color:'#ffd93d'},
        {icon:'üí°',name:'√ânergie',color:'#f8b400'},
        {icon:'‚ù§Ô∏è',name:'Sant√©',color:'#ff9ff3'}
    ];
    
    const baseIncome = [
        {icon:'üí∞',name:'Salaire',color:'#4ecdc4'},
        {icon:'üìà',name:'Business',color:'#ffd93d'},
        {icon:'üéÅ',name:'Autres',color:'#95e1d3'}
    ];
    
    let allCategories = type === 'expense' ? baseExpense : baseIncome;
    
    // ‚úÖ AJOUTER CAT√âGORIES PERSONNALIS√âES
    allCategories = allCategories.concat(
        customCategories.map(cat => ({
            icon: cat.icon,
            name: cat.name,
            color: cat.color
        }))
    );
    
    return allCategories;
}

// ‚úÖ MODIFI√â : getSpentByCategory() g√®re nouvelles cat√©gories
function getSpentByCategory(category) {
    return Math.abs(transactions
        .filter(t => t.category === category && t.amount < 0)
        .reduce((sum, t) => sum + Math.abs(t.amount), 0));
}

// ‚úÖ MODIFI√â : renderSuggestions() affiche nouvelles cat√©gories
function renderSuggestions() {
    const total = getTotalBudget();
    if (total <= 0) {
        document.getElementById('suggestionList').innerHTML = 
            '<div style="text-align:center;padding:20px;color:rgba(255,255,255,0.6)">üí° Entrez un budget pour les suggestions</div>';
        return;
    }

    // Cat√©gories de base + personnalis√©es
    const allCategories = getCategories('expense');
    let html = '';

    allCategories.forEach(cat => {
        const budgeted = customBudget[cat.name] != null ? customBudget[cat.name] : 0;
        const spent = getSpentByCategory(cat.name);
        const percentUsed = budgeted > 0 ? (spent / budgeted * 100) : 0;
        
        let statusClass = 'budget-ok';
        let statusText = '‚úÖ OK';
        let progressClass = 'progress-ok';
        
        if (percentUsed > 90) {
            statusClass = 'budget-danger';
            statusText = 'üö® D√âPASSE';
            progressClass = 'progress-danger';
        } else if (percentUsed > 75) {
            statusClass = 'budget-warning';
            statusText = '‚ö†Ô∏è ATTENTION';
            progressClass = 'progress-warning';
        }

        html += `
        <div class="suggestion-item ${statusClass}" onclick="this.querySelector('input').focus()">
            <div style="display:flex;align-items:center;gap:8px;flex:1">
                <span style="font-size:16px">${cat.icon}</span>
                <div>
                    <div style="font-weight:600">${cat.name}</div>
                    <div class="spent-info">D√©pens√©: ${formatAr(spent)} (${Math.round(percentUsed)}%)</div>
                </div>
            </div>
            <div style="display:flex;align-items:center;gap:12px">
                <input
                    type="number"
                    value="${budgeted}"
                    min="0"
                    onchange="updateCustomBudget('${cat.name}', this.value)"
                    class="budget-input"
                    placeholder="0"
                >
                <div class="progress-bar">
                    <div class="progress-fill ${progressClass}" style="width:${Math.min(percentUsed,100)}%"></div>
                </div>
                <span style="font-weight:700;min-width:80px">${statusText}</span>
            </div>
        </div>`;
    });

    document.getElementById('suggestionList').innerHTML = html;
}

// ... (toutes les autres fonctions restent IDENTIQUES)
</script>
</body>
</html>
