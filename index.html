<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Budget Pro AI+ ‚úÖ BUDGET MODIFIABLE + ALERTES</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* CSS existant + NOUVEAU pour alertes */
*{margin:0;padding:0;box-sizing:border-box}
:root{--primary:#3f51b5;--accent:#ffd700;--glass:rgba(255,255,255,0.1);--success:#4ecdc4;--warning:#ff6b6b;--danger:#ef4444;--bg-dark:linear-gradient(135deg,#0a0e17,#1a237e);--radius:16px}
body{font-family:'Inter',sans-serif;background:var(--bg-dark);color:#fff;min-height:100vh}
/* ... (tout le CSS existant reste identique jusqu'√† suggestion-item) ... */
.suggestion-item{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid rgba(255,255,255,0.1);transition:all 0.2s;cursor:pointer}
.suggestion-item:hover{background:rgba(255,255,255,0.1)}
.suggestion-item input{width:140px;padding:10px;border-radius:10px;border:2px solid rgba(255,215,0,0.5);background:#fff;color:#000;font-size:14px;text-align:right;font-weight:600}
.suggestion-item input:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(255,215,0,0.2)}
/* ‚úÖ NOUVEAU : Alertes visuelles */
.budget-ok {border-color:var(--success)!important;background:var(--success)15!important}
.budget-warning {border-color:var(--warning)!important;background:var(--warning)20!important}
.budget-danger {border-color:var(--danger)!important;background:var(--danger)25!important}
.spent-info{font-size:12px;opacity:0.8;margin-top:4px}
.progress-bar{width:80px;height:6px;background:rgba(255,255,255,0.2);border-radius:3px;overflow:hidden;display:inline-block;margin-left:8px}
.progress-fill{height:100%;transition:width 0.5s ease;border-radius:3px}
.progress-ok{background:var(--success)}
.progress-warning{background:var(--warning)}
.progress-danger{background:var(--danger)}
/* ... reste du CSS existant ... */
</style>
</head>
<body>
<!-- HTML identique jusqu'aux suggestions -->
<div class="balance-card">
<h3 style="margin-bottom:16px">üí° Budget sugg√©r√© <span style="font-size:14px;opacity:0.7">(modifiable + alertes)</span></h3>
<div id="suggestionList"></div>
</div>
<!-- ... reste HTML identique ... -->
</body>

<script>
// VARIABLES GLOBALES + NOUVEAU customBudget
let transactions = JSON.parse(localStorage.getItem('budgetProTransactions') || '[]');
let savings = parseFloat(localStorage.getItem('budgetProSavings') || '0');
let monthlyBudget = Number(localStorage.getItem('budgetProMonthly') || 0);
let peopleCount = Number(localStorage.getItem('budgetProPeople') || 1);
let payRent = localStorage.getItem('budgetProRent') === 'true';
let selectedProfile = localStorage.getItem('budgetProProfile') || 'balanced';
let selectedCategory = -1;
let chart = null;
let customBudget = JSON.parse(localStorage.getItem('budgetProCustomBudget') || '{}'); // ‚úÖ NOUVEAU

// INIT
document.addEventListener('DOMContentLoaded', function() {
    loadUI();
    renderAll();
});

// ... (toutes les fonctions existantes restent identiques jusqu'√† renderSuggestions) ...

// ‚úÖ NOUVEAU : Calcul d√©penses par cat√©gorie
function getSpentByCategory(category) {
    return Math.abs(transactions
        .filter(t => t.category === category && t.amount < 0)
        .reduce((sum, t) => sum + Math.abs(t.amount), 0));
}

// ‚úÖ FONCTION RENDERSUGGESTIONS COMPL√àTEMENT R√â√©crite
function renderSuggestions() {
    const total = getTotalBudget();
    if (total <= 0) {
        document.getElementById('suggestionList').innerHTML = 
            '<div style="text-align:center;padding:20px;color:rgba(255,255,255,0.6)">üí° Entrez un budget pour les suggestions</div>';
        return;
    }

    const profiles = {
        balanced: {Nourriture:0.25, Transport:0.12, Logement:payRent?0.35:0, √âpargne:0.20, Sant√©:0.08},
        security: {Nourriture:0.30, Transport:0.10, Logement:payRent?0.30:0, √âpargne:0.25, Sant√©:0.10},
        comfort: {Nourriture:0.22, Transport:0.15, Logement:payRent?0.38:0, √âpargne:0.15, Loisirs:0.10}
    };

    const profile = profiles[selectedProfile];
    let html = '';

    Object.entries(profile).forEach(([cat, pct]) => {
        if (pct <= 0) return;

        const suggested = Math.round(total * pct);
        const budgeted = customBudget[cat] != null ? customBudget[cat] : suggested;
        const spent = getSpentByCategory(cat);
        const percentUsed = budgeted > 0 ? (spent / budgeted * 100) : 0;
        
        // ‚úÖ Calcul alerte
        let statusClass = 'budget-ok';
        let statusText = '‚úÖ OK';
        let progressClass = 'progress-ok';
        
        if (percentUsed > 90) {
            statusClass = 'budget-danger';
            statusText = 'üö® D√âPASSE';
            progressClass = 'progress-danger';
        } else if (percentUsed > 75) {
            statusClass = 'budget-warning';
            statusText = '‚ö†Ô∏è ATTENTION';
            progressClass = 'progress-warning';
        }

        html += `
        <div class="suggestion-item ${statusClass}" onclick="this.querySelector('input').focus()">
            <div style="display:flex;align-items:center;gap:8px;flex:1">
                <span style="font-size:16px">${getCategoryIcon(cat)}</span>
                <div>
                    <div style="font-weight:600">${cat}</div>
                    <div class="spent-info">D√©pens√©: ${formatAr(spent)} (${Math.round(percentUsed)}%)</div>
                </div>
            </div>
            <div style="display:flex;align-items:center;gap:12px">
                <input
                    type="number"
                    value="${budgeted}"
                    min="0"
                    onchange="updateCustomBudget('${cat}', this.value)"
                    class="budget-input"
                    placeholder="${formatAr(suggested)}"
                >
                <div class="progress-bar">
                    <div class="progress-fill ${progressClass}" style="width:${Math.min(percentUsed,100)}%"></div>
                </div>
                <span style="font-weight:700;min-width:80px">${statusText}</span>
            </div>
        </div>`;
    });

    document.getElementById('suggestionList').innerHTML = html;
}

// ‚úÖ NOUVEAU : Icones par cat√©gorie
function getCategoryIcon(cat) {
    const icons = {
        'Nourriture': 'üçî', 'Transport': 'üöó', 'Logement': 'üè†', '√âpargne': 'üíé',
        'Sant√©': '‚ù§Ô∏è', 'Internet': 'üì±', '√ânergie': 'üí°', 'Loisirs': 'üéâ', 'Business': 'üìà'
    };
    return icons[cat] || 'üìä';
}

// ‚úÖ NOUVEAU : Mise √† jour budget personnalis√©
function updateCustomBudget(category, value) {
    customBudget[category] = Number(value) || 0;
    localStorage.setItem('budgetProCustomBudget', JSON.stringify(customBudget));
    renderSuggestions(); // Refresh imm√©diat
    renderAll();
    showToast(`üí∞ Budget ${category} : ${formatAr(Number(value))}`);
}

// ‚úÖ MODIFI√â : loadUI pour charger customBudget
function loadUI() {
    document.getElementById('monthlyBudget').value = monthlyBudget;
    document.getElementById('peopleCount').value = peopleCount;
    document.getElementById('payRent').checked = payRent;
    document.querySelectorAll('.profile-badge').forEach(btn => {
        const profile = btn.textContent.includes('√âquilibr√©') ? 'balanced' : 
                       btn.textContent.includes('S√©curit√©') ? 'security' : 'comfort';
        btn.classList.toggle('active', profile === selectedProfile);
    });
    const isLight = localStorage.getItem('budgetProTheme') === 'light';
    if (isLight) document.body.classList.add('light');
    document.getElementById('themeToggle').textContent = isLight ? 'üåô' : '‚òÄÔ∏è';
}

// ‚úÖ MODIFI√â : exportData pour inclure customBudget
function exportData() {
    const data = { 
        transactions, 
        savings, 
        customBudget,  // ‚úÖ Ajout√©
        config: {monthlyBudget, peopleCount, payRent, selectedProfile}
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'budget-pro.json';
    a.click();
    URL.revokeObjectURL(url);
    showToast('üìä Export√© avec budgets personnalis√©s !');
}

// ‚úÖ MODIFI√â : resetData pour effacer customBudget
function resetData() {
    if (confirm('Tout r√©initialiser ?')) {
        transactions = [];
        savings = 0;
        customBudget = {};  // ‚úÖ Reset
        localStorage.clear();
        renderAll();
        showToast('üßπ Reset complet');
    }
}

// ... (TOUTES LES AUTRES FONCTIONS RESTENT IDENTIQUES : getTotalBudget, updateStats, renderTransactions, etc.)
// Copie-colle toutes les fonctions existantes ici (addTransaction, updateCategories, etc.)
</script>
</body>
</html>
